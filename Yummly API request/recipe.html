<!DOCTYPE html>
<html>

<head>
    <title>Ajax</title>
    <meta charset="utf-8" />
    <script src="jquery.min.js"></script>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

</head>

<body>
    <p id="p1"></p>
    <table id="recipes">
    </table>
    <table id="newrecipe">
    </table>

</body>
</html>



///
<script>
    // For error handling http requests
    function handleError(status) {
        if (status === 400) {
            console.log('Bad request, often due to missing a required parameter.');
        } else if (status === 401) {
            console.log('No valid API key provided.');
        } else if (status === 404) {
            console.log('The requested resource doesn\'t exist.');
        }
    }




    <!-- // to start server http-server . -o -->
    <!-- // Global data for GET request -->
    <!-- var gl_data = []; -->
    <!-- var newTable = $('#newrecipe'); -->
    <!-- var table = $('#recipes'); -->
    <!-- const xhttp = new XMLHttpRequest(); -->

    // Loads initial depending on ingredient request.
    $(document).ready(function updateLayout() {

        let url = "http://127.0.0.1:3000/recipes";
        xhttp.open("GET", url, true);
        xhttp.send();
        xhttp.onreadystatechange = processRequest;

        function processRequest(e) {
            if (xhttp.readyState == 4 && this.status == 200) {
                var response = JSON.parse(xhttp.responseText);
                gl_data = response;
                appendRequest(response);

            } else {
                handleError(xhttp.status);
            }



        }
    })




    // Gets ID of <img> that was clicked
    // Sends a specified recipe request to http://127.0.0.1:3000/recipesID depending on picture that was click.
    function send_recipeURL(clicked_id) {
        let url = "http://127.0.0.1:3000/recipesID";
        xhttp.open("POST", url, true);
        xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhttp.send(gl_data['matches'][clicked_id]["id"]);
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                alert("ready");
                updateLayout()
            } else {
                handleError(xhttp.status);
            }
        };
    }




    // Updates layout with new Recipe Specifics
    function updateLayout() {
        let url = "http://127.0.0.1:3000/specifiedrecipe";
        xhttp.open("GET", url, true);
        xhttp.send();
        xhttp.onreadystatechange = processRequest;

        function processRequest(e) {
            if (xhttp.readyState == 4 && this.status == 200) {
                var response = JSON.parse(xhttp.responseText);
                processRecipe(response);
            } else {
                handleError(xhttp.status);
            }


        };
    }

    // Processes initial JSON object and appends it to HTML Elements
    function appendRequest(data) {
        var i;
        var arrLength = data['matches'].length;
        for (i = 0; i < arrLength; i++) {
            var img = data['matches'][i]['imageUrlsBySize']
            // Formats image size before sending request --
            var recipeId = "" + Object.keys(img).map(function(key) {
                return img[key]
            });
            var res = recipeId.replace(/=s90-c/g, "=s240-c");
            // ----------------------------------------------
            table.append("<tr><td>" + "Recipe Name: " + data['matches'][i]["recipeName"]);
            table.append("<a id=" + i + "  onClick='send_recipeURL(this.id)' '>" + "<img  src='" + res + "' class='hello' />" + "</a>");
            table.append("<tr><td>" + "--------------------------------" + "</td></tr>");
        }
    }

    // Process the new ingredient that was clicked.
    function processRecipe(body) {

        var img = body['images'][0].hostedLargeUrl;
        newTable.append("<img  src='" + img + "' class='hello' />");
        newTable.append("<tr><td>" + "Recipe name: " + body['name']);
        newTable.append("<tr><td>" + "Ingredients: " + body['ingredientLines']);

    }
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
       // // When submit button is clicked this function is called
    // // Sends Array of ingredients to app2.JS Node*
    // // POST to http://127.0.0.1:3000/recipeURL
    // function submission() {
    // //console.log("unfiltered = " + ingredientArray);
    // var submitArray;
    // submitArray = filter_array(ingredientArray);
    // //console.log("filtered = " + submitArray);

    // let url = "http://127.0.0.1:3000/recipeURL";
    // xhttp.open("POST", url, true);
    // xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    // xhttp.send(submitArray);
    // xhttp.onreadystatechange = function() {
    // if (this.readyState == 4 && this.status == 200) {
    // let url = "http://127.0.0.1:3000/recipes";
    // xhttp.open("GET", url, true);
    // xhttp.send();
    // xhttp.onreadystatechange = processRequest;

    // console.log("recieved");
    // function processRequest(e) {
    // if (xhttp.readyState == 4 && this.status == 200) {

    // console.log("where going in");

    // var response = JSON.parse(xhttp.responseText);
    // gl_data = response;
    // appendRequest(response);

    // } else {
    // handleError(xhttp.status);
    // }



    // }

    // };
    // }
    // }



    // // Processes initial JSON object and appends it to HTML Elements
    // function appendRequest(data) {
    // var i;
    // var arrLength = data['matches'].length;
    // console.log(arrLength);
    // for (i = 0; i < arrLength; i++) {
    // var img = data['matches'][i]['imageUrlsBySize']
    // // Formats image size before sending request --
    // var recipeId = "" + Object.keys(img).map(function(key) {
    // return img[key]
    // });
    // var res = recipeId.replace(/=s90-c/g, "=s240-c");
    // // ----------------------------------------------
    // console.log("appending");
    // table.append("<tr><td>" + "Recipe Name: " + data['matches'][i]["recipeName"]);
    // table.append("<a id=" + i + "  onClick='send_recipeURL(this.id)' '>" + "<img  src='" + res + "' class='hello' />" + "</a>");
    // table.append("<tr><td>" + "--------------------------------" + "</td></tr>");
    // }
    // }
</script>






















